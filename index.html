<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Cloud Clock - Remote Ready</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;500;700&family=Orbitron:wght@400;700&family=Roboto+Mono:wght@400;700&family=Lora:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
    
    <style>
        /* SAMA SEPERTI SEBELUMNYA - CSS LENGKAP */
        :root {
            --bg-color: #000000;
            --text-color: #ffffff;
            --shadow-color: rgba(0,0,0,0.5);
            --shadow-blur: 0px;
            --font-family: 'Rubik', sans-serif;
            --clock-size: 25vw;
            --clock-weight: 700;
            --letter-spacing: -5px;
            --date-size: 2vw;
            --date-color: #aaaaaa;
            --date-display: none;
            --marquee-size: 3vw;
            --marquee-color: #ffcc00;
            --marquee-bg: #111111;
            --marquee-display: none;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-family);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: background 0.5s ease, color 0.5s ease;
        }

        /* STATUS INDIKATOR (Pojok Kiri Atas) */
        #status-indicator {
            position: fixed;
            top: 10px;
            left: 10px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: red; /* Merah = Offline, Hijau = Online */
            z-index: 100;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        .clock-container { text-align: center; z-index: 5; position: relative; }

        #clock {
            font-size: var(--clock-size);
            font-weight: var(--clock-weight);
            letter-spacing: var(--letter-spacing);
            text-shadow: 4px 4px var(--shadow-blur) var(--shadow-color);
            line-height: 1;
            font-variant-numeric: tabular-nums;
            white-space: nowrap;
        }

        .blink-animation { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

        #date-display {
            font-size: var(--date-size);
            color: var(--date-color);
            margin-top: 10px;
            font-weight: 300;
            display: var(--date-display);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .marquee-container {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: var(--marquee-bg); color: var(--marquee-color);
            font-size: var(--marquee-size); padding: 10px 0;
            white-space: nowrap; overflow: hidden;
            display: var(--marquee-display); z-index: 10;
        }

        .marquee-content {
            display: inline-block; padding-left: 100%;
            animation: marquee 20s linear infinite;
        }
        @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }

        /* UI ADMIN */
        .admin-trigger { position: fixed; top: 0; right: 0; width: 60px; height: 60px; z-index: 999; cursor: pointer; opacity: 0.1; display:flex; justify-content:center; align-items:center; font-size:24px;}
        .admin-trigger:hover { background: rgba(255,255,255,0.1); opacity: 1; }

        #admin-panel {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.95); z-index: 1000; padding: 20px; overflow-y: auto;
            font-family: sans-serif; color: #fff;
        }
        .panel-content { max-width: 600px; margin: 0 auto; background: #222; padding: 20px; border-radius: 10px; border: 1px solid #444; }
        .control-group { background: #333; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .control-group h4 { color: #aaa; margin-bottom: 10px; font-size: 0.9rem; border-bottom: 1px solid #555; padding-bottom: 5px; }
        label { display: block; margin-bottom: 5px; font-size: 0.85rem; color: #ccc; }
        input, select { width: 100%; margin-bottom: 10px; background: #444; border: 1px solid #666; color: white; padding: 8px; border-radius: 4px; }
        input[type="color"] { height: 40px; padding: 2px; }
        input[type="checkbox"] { width: auto; margin-right: 10px; }
        .btn { padding: 12px; width: 100%; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px; font-size: 1rem;}
        .btn-primary { background: #007bff; color: white; }
        .btn-close { background: #555; color: white; margin-top: 20px; }
    </style>
</head>
<body>

    <!-- Indikator Koneksi Firebase -->
    <div id="status-indicator" title="Merah: Offline, Hijau: Online"></div>

    <!-- TRIGGER ADMIN -->
    <div class="admin-trigger" id="admin-trigger">‚öôÔ∏è</div>

    <!-- TAMPILAN JAM -->
    <div class="clock-container">
        <div id="clock">
            <span id="h">00</span><span class="sep">:</span><span id="m">00</span><span class="sep">:</span><span id="s">00</span>
        </div>
        <div id="date-display">...</div>
    </div>

    <!-- RUNNING TEXT -->
    <div class="marquee-container">
        <div class="marquee-content" id="marquee-text">Menunggu Data...</div>
    </div>

    <!-- ADMIN PANEL -->
    <div id="admin-panel">
        <div class="panel-content">
            <h2 style="margin-bottom:20px; text-align:center;">üéõÔ∏è REMOTE CONTROL</h2>
            <p style="text-align:center; color:#888; margin-bottom:20px; font-size:0.9rem;">
                Ubah di sini, Proyektor berubah otomatis.
            </p>

            <div class="control-group">
                <h4>Warna & Tampilan</h4>
                <label>Background</label><input type="color" id="inp-bg-color">
                <label>Warna Teks</label><input type="color" id="inp-text-color">
                <label>Font</label>
                <select id="inp-font">
                    <option value="'Rubik', sans-serif">Tebal Modern (Rubik)</option>
                    <option value="'Orbitron', sans-serif">Digital (Orbitron)</option>
                    <option value="'Lora', serif">Klasik (Lora)</option>
                </select>
                <label>Ukuran Jam</label><input type="range" min="10" max="40" id="inp-size">
            </div>

            <div class="control-group">
                <h4>Running Text</h4>
                <label><input type="checkbox" id="inp-show-marquee"> Tampilkan Pesan</label>
                <input type="text" id="inp-marquee-text" placeholder="Isi pesan...">
                <label>Warna Background Pesan</label><input type="color" id="inp-marquee-bg">
            </div>

            <button class="btn btn-primary" id="btn-sync">üì° UPDATE KE PROYEKTOR</button>
            <button class="btn btn-close" onclick="document.getElementById('admin-panel').style.display='none'">Tutup Menu</button>
        </div>
    </div>

    <!-- SCRIPT TIPE MODULE UTK FIREBASE -->
    <script type="module">
        // ======================================================
        // 1. IMPORT FIREBASE (JANGAN DIUBAH)
        // ======================================================
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // ======================================================
        // 2. KONFIGURASI FIREBASE (WAJIB DIGANTI MILIK ANDA!!)
        // ======================================================
        const firebaseConfig = {
            apiKey: "AIzaSyDoPT7JSD5N-p2V50PnozpAGvln64eREFI",
            authDomain: "jamdigi-7f8a3.firebaseapp.com",
            projectId: "jamdigi-7f8a3",
            storageBucket: "jamdigi-7f8a3.firebasestorage.app",
            messagingSenderId: "725447503980",
            appId: "1:725447503980:web:2a7c472a35dc71dae3a849",
            measurementId: "G-PESLX8VZ5W"
        };

        // Inisialisasi Firebase
        let db;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            console.log("Firebase Init Success");
            document.getElementById('status-indicator').style.background = 'orange'; // Connecting
        } catch (e) {
            console.error("Firebase Error:", e);
            alert("Gagal konek Firebase. Cek Config di kodingan!");
        }

        // ======================================================
        // 3. LOGIKA APLIKASI UTAMA
        // ======================================================
        
        // Default Config
        let config = {
            bgColor: '#000000', textColor: '#ffffff', fontFamily: "'Rubik', sans-serif",
            clockSize: 25, showMarquee: false, marqueeText: "Selamat Datang",
            marqueeBg: "#222222"
        };

        const docRef = doc(db, "settings", "clock_config"); // Nama tabel di database

        // A. FUNGSI MENERIMA DATA (TV/PROYEKTOR)
        if(db) {
            onSnapshot(docRef, (doc) => {
                if (doc.exists()) {
                    console.log("Data diterima dari cloud!", doc.data());
                    config = { ...config, ...doc.data() };
                    applyConfig();
                    document.getElementById('status-indicator').style.background = '#00ff00'; // Online Hijau
                    syncInputs(); // Update input di admin panel juga biar sinkron
                } else {
                    // Jika data belum ada di cloud, buat default
                    setDoc(docRef, config);
                }
            }, (error) => {
                console.error("Error ambil data:", error);
                document.getElementById('status-indicator').style.background = 'red'; // Error Merah
            });
        }

        // B. FUNGSI MENGIRIM DATA (REMOTE HP)
        document.getElementById('btn-sync').addEventListener('click', async () => {
            const btn = document.getElementById('btn-sync');
            btn.innerText = "Mengirim...";
            
            // Ambil nilai dari input
            const newConfig = {
                bgColor: document.getElementById('inp-bg-color').value,
                textColor: document.getElementById('inp-text-color').value,
                fontFamily: document.getElementById('inp-font').value,
                clockSize: document.getElementById('inp-size').value,
                showMarquee: document.getElementById('inp-show-marquee').checked,
                marqueeText: document.getElementById('inp-marquee-text').value,
                marqueeBg: document.getElementById('inp-marquee-bg').value
            };

            try {
                await setDoc(docRef, newConfig);
                btn.innerText = "‚úÖ SUKSES TERKIRIM";
                setTimeout(() => btn.innerText = "üì° UPDATE KE PROYEKTOR", 2000);
            } catch (e) {
                alert("Gagal kirim: " + e.message);
                btn.innerText = "‚ùå GAGAL";
            }
        });

        // ======================================================
        // 4. FUNGSI UI & VISUAL
        // ======================================================

        function applyConfig() {
            const r = document.documentElement.style;
            r.setProperty('--bg-color', config.bgColor);
            r.setProperty('--text-color', config.textColor);
            r.setProperty('--font-family', config.fontFamily);
            r.setProperty('--clock-size', config.clockSize + 'vw');
            r.setProperty('--marquee-display', config.showMarquee ? 'block' : 'none');
            r.setProperty('--marquee-bg', config.marqueeBg);
            document.getElementById('marquee-text').innerText = config.marqueeText;
        }

        function syncInputs() {
            document.getElementById('inp-bg-color').value = config.bgColor;
            document.getElementById('inp-text-color').value = config.textColor;
            document.getElementById('inp-font').value = config.fontFamily;
            document.getElementById('inp-size').value = config.clockSize;
            document.getElementById('inp-show-marquee').checked = config.showMarquee;
            document.getElementById('inp-marquee-text').value = config.marqueeText;
            document.getElementById('inp-marquee-bg').value = config.marqueeBg;
        }

        // JAM DIGITAL ENGINE
        function runClock() {
            const now = new Date();
            const h = String(now.getHours()).padStart(2, '0');
            const m = String(now.getMinutes()).padStart(2, '0');
            const s = String(now.getSeconds()).padStart(2, '0');
            
            document.getElementById('h').innerText = h;
            document.getElementById('m').innerText = m;
            document.getElementById('s').innerText = s;

            const opt = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('date-display').innerText = now.toLocaleDateString('id-ID', opt);
            document.getElementById('date-display').style.display = 'block';
        }
        setInterval(runClock, 1000);
        runClock();

        // ADMIN TRIGGER
        const adminPanel = document.getElementById('admin-panel');
        document.getElementById('admin-trigger').addEventListener('click', () => {
            const pin = prompt("Masukkan PIN Admin:");
            if(pin === "1234") {
                adminPanel.style.display = 'block';
                syncInputs();
            }
        });

    </script>
</body>
</html>



