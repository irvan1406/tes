<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mega Clock - Firebase Remote</title>
    
    <!-- LOAD BANYAK FONT KEREN -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;500;700&family=Orbitron:wght@400;700&family=Share+Tech+Mono&family=Fredoka:wght@400;600&family=Dancing+Script:wght@700&family=Bebas+Neue&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* DEFAULT VARIABLES (Akan ditimpa oleh Firebase) */
            --bg-type: #000000; /* Color or URL */
            --text-color: #ffffff;
            --font-family: 'Rubik', sans-serif;
            --clock-size: 25vw;
            --clock-glow: 0px;
            --clock-shadow: #000000;
            
            --title-size: 3vw;
            --title-color: #ffd700;
            --title-display: block;

            --date-size: 2vw;
            --date-color: #aaaaaa;
            --date-display: block;

            --marquee-bg: #111;
            --marquee-color: #fff;
            --marquee-speed: 15s;
            --marquee-display: flex;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: var(--bg-type);
            background-size: cover;
            background-position: center;
            color: var(--text-color);
            font-family: var(--font-family);
            height: 100vh; width: 100vw; overflow: hidden;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            transition: all 0.5s ease;
        }

        /* LAYOUT UTAMA */
        .main-wrapper {
            display: flex; flex-direction: column; 
            align-items: center; justify-content: center;
            z-index: 10; width: 100%;
        }

        /* LOGO */
        #logo-img {
            max-height: 15vh; margin-bottom: 2vh;
            display: none; /* Default hidden */
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5));
        }

        /* JUDUL INSTANSI */
        #main-title {
            font-size: var(--title-size);
            color: var(--title-color);
            display: var(--title-display);
            text-shadow: 0 2px 5px rgba(0,0,0,0.5);
            margin-bottom: 1vh;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* JAM UTAMA */
        #clock {
            font-size: var(--clock-size);
            font-weight: 700;
            line-height: 1;
            white-space: nowrap;
            text-shadow: 0 0 var(--clock-glow) var(--text-color), 4px 4px 0px var(--clock-shadow);
        }

        /* TANGGAL */
        #date {
            font-size: var(--date-size);
            color: var(--date-color);
            display: var(--date-display);
            margin-top: 2vh;
            font-weight: 300;
        }

        /* RUNNING TEXT */
        .marquee-wrapper {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: var(--marquee-bg);
            color: var(--marquee-color);
            padding: 10px 0;
            display: var(--marquee-display);
            z-index: 20;
            font-size: 2.5vw;
            white-space: nowrap; overflow: hidden;
            border-top: 2px solid rgba(255,255,255,0.1);
        }
        .marquee-content {
            display: inline-block; padding-left: 100%;
            animation: marquee var(--marquee-speed) linear infinite;
        }
        @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }

        /* DEBUG LOG */
        #debug-log {
            position: fixed; bottom: 60px; right: 10px;
            background: rgba(0,0,0,0.6); color: #0f0;
            font-family: monospace; font-size: 10px;
            padding: 5px; border-radius: 5px; pointer-events: none;
            z-index: 999; opacity: 0.7;
        }

        /* ADMIN TRIGGER */
        .admin-trigger { 
            position: fixed; top: 0; right: 0; width: 60px; height: 60px; 
            z-index: 900; cursor: pointer; opacity: 0.2; 
            display: flex; align-items: center; justify-content: center; font-size: 24px;
        }
        .admin-trigger:hover { opacity: 1; background: rgba(255,255,255,0.1); }

        /* =========================================
           ADMIN PANEL STYLES (MODAL)
           ========================================= */
        #admin-panel {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #121212; z-index: 1000; overflow-y: auto;
            color: #eee; font-family: sans-serif;
        }
        
        .panel-container { max-width: 600px; margin: 0 auto; padding-bottom: 50px; }
        
        /* Header Admin */
        .admin-header {
            background: #1f1f1f; padding: 20px; position: sticky; top: 0; z-index: 1001;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #333;
        }
        .admin-header h2 { font-size: 1.2rem; color: #00d4ff; }
        
        /* Tabs */
        .tabs { display: flex; background: #222; overflow-x: auto; }
        .tab-btn {
            flex: 1; padding: 15px; border: none; background: transparent; color: #888;
            font-weight: bold; cursor: pointer; border-bottom: 3px solid transparent;
            min-width: 80px;
        }
        .tab-btn.active { color: white; border-bottom-color: #00d4ff; background: #2a2a2a; }

        /* Content Sections */
        .tab-content { display: none; padding: 20px; }
        .tab-content.active { display: block; }

        /* Form Elements */
        .control-group { background: #1e1e1e; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #333; }
        .control-group h4 { color: #aaa; margin-bottom: 10px; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        
        label { display: block; margin-top: 10px; margin-bottom: 5px; font-size: 0.9rem; color: #ddd; }
        input[type="text"], input[type="number"], select {
            width: 100%; padding: 10px; background: #2c2c2c; border: 1px solid #444; color: white; border-radius: 5px;
        }
        input[type="color"] { width: 100%; height: 40px; border: none; padding: 0; background: none; }
        input[type="range"] { width: 100%; margin: 10px 0; }
        
        /* Checkbox Switch */
        .switch-wrap { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
        .switch-wrap input { width: 20px; height: 20px; }

        /* Buttons */
        .btn-action {
            width: 100%; padding: 15px; border: none; border-radius: 8px;
            font-size: 1rem; font-weight: bold; cursor: pointer; margin-top: 10px;
            transition: transform 0.1s;
        }
        .btn-save { background: linear-gradient(45deg, #00d4ff, #0051ff); color: white; box-shadow: 0 4px 15px rgba(0, 81, 255, 0.4); }
        .btn-save:active { transform: scale(0.98); }
        .btn-danger { background: #ff3333; color: white; margin-top: 50px; }
        
        .preset-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .preset-btn { background: #333; border: 1px solid #555; padding: 10px; color: white; border-radius: 5px; cursor: pointer; }

    </style>
</head>
<body>

    <!-- LOG SISTEM -->
    <div id="debug-log">System Ready...</div>

    <!-- MAIN DISPLAY -->
    <div class="main-wrapper">
        <img id="logo-img" src="" alt="Logo">
        <div id="main-title">JUDUL INSTANSI</div>
        <div id="clock">00:00:00</div>
        <div id="date">Senin, 1 Januari 2024</div>
    </div>

    <!-- RUNNING TEXT -->
    <div class="marquee-wrapper">
        <div class="marquee-content" id="marquee-text">Selamat Datang...</div>
    </div>

    <!-- ADMIN TRIGGER BUTTON -->
    <div class="admin-trigger" id="admin-trigger">‚öôÔ∏è</div>

    <!-- =========================================
         PANEL ADMIN MEGA UPDATE
         ========================================= -->
    <div id="admin-panel">
        <div class="admin-header">
            <h2>üéõÔ∏è Control Center</h2>
            <button onclick="closeAdmin()" style="background:transparent; border:none; color:#fff; font-size:1.5rem;">‚úï</button>
        </div>
        
        <div class="panel-container">
            <!-- TAB NAVIGATION -->
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('tab-visual')">üé® Visual</button>
                <button class="tab-btn" onclick="switchTab('tab-clock')">‚è∞ Jam</button>
                <button class="tab-btn" onclick="switchTab('tab-text')">üìù Teks</button>
                <button class="tab-btn" onclick="switchTab('tab-media')">üñºÔ∏è Media</button>
            </div>

            <!-- TAB 1: VISUAL & BACKGROUND -->
            <div id="tab-visual" class="tab-content active">
                <div class="control-group">
                    <h4>Background</h4>
                    <label>Mode Background</label>
                    <select id="inp-bg-mode" onchange="toggleBgInput()">
                        <option value="color">Warna Solid</option>
                        <option value="gradient">Gradient Elegan</option>
                        <option value="image">Gambar / URL</option>
                    </select>
                    
                    <div id="bg-color-group">
                        <label>Pilih Warna</label>
                        <input type="color" id="inp-bg-color" value="#000000">
                    </div>
                    
                    <div id="bg-url-group" style="display:none;">
                        <label>URL Gambar (Link)</label>
                        <input type="text" id="inp-bg-url" placeholder="https://...">
                    </div>
                </div>

                <div class="control-group">
                    <h4>Tema Warna</h4>
                    <label>Warna Jam & Teks Utama</label>
                    <input type="color" id="inp-text-color" value="#ffffff">
                    
                    <label>Jenis Font</label>
                    <select id="inp-font">
                        <option value="'Rubik', sans-serif">Modern Tebal (Rubik)</option>
                        <option value="'Orbitron', sans-serif">Digital Sci-Fi (Orbitron)</option>
                        <option value="'Share Tech Mono', monospace">Terminal Code</option>
                        <option value="'Bebas Neue', sans-serif">Bebas Neue (Tall)</option>
                        <option value="'Dancing Script', cursive">Tulisan Sambung</option>
                        <option value="'Fredoka', sans-serif">Bulat Lucu</option>
                    </select>
                </div>
            </div>

            <!-- TAB 2: PENGATURAN JAM -->
            <div id="tab-clock" class="tab-content">
                <div class="control-group">
                    <h4>Ukuran & Efek</h4>
                    <label>Ukuran Jam (Zoom)</label>
                    <input type="range" id="inp-clock-size" min="10" max="50" value="25">
                    
                    <label>Efek Cahaya Neon (Glow)</label>
                    <input type="range" id="inp-clock-glow" min="0" max="50" value="0">
                    
                    <label>Warna Bayangan</label>
                    <input type="color" id="inp-clock-shadow" value="#000000">
                </div>
            </div>

            <!-- TAB 3: JUDUL, TANGGAL & MARQUEE -->
            <div id="tab-text" class="tab-content">
                <div class="control-group">
                    <h4>Judul Atas (Nama Masjid/Kantor)</h4>
                    <div class="switch-wrap">
                        <span>Tampilkan Judul</span>
                        <input type="checkbox" id="inp-show-title" checked>
                    </div>
                    <label>Isi Judul</label>
                    <input type="text" id="inp-title-text" placeholder="NAMA INSTANSI">
                    <label>Warna Judul</label>
                    <input type="color" id="inp-title-color" value="#ffd700">
                </div>

                <div class="control-group">
                    <h4>Running Text (Bawah)</h4>
                    <div class="switch-wrap">
                        <span>Aktifkan Running Text</span>
                        <input type="checkbox" id="inp-show-marquee">
                    </div>
                    <label>Isi Pesan</label>
                    <input type="text" id="inp-marquee-text" placeholder="Pesan pengumuman...">
                    
                    <div style="display:flex; gap:10px;">
                        <div style="flex:1"><label>Warna Teks</label><input type="color" id="inp-marquee-color" value="#ffffff"></div>
                        <div style="flex:1"><label>Background</label><input type="color" id="inp-marquee-bg" value="#111111"></div>
                    </div>
                    
                    <label>Kecepatan (Makin kecil makin cepat)</label>
                    <input type="range" id="inp-marquee-speed" min="5" max="60" value="15">
                </div>

                <div class="control-group">
                    <h4>Tanggal</h4>
                    <div class="switch-wrap">
                        <span>Tampilkan Tanggal</span>
                        <input type="checkbox" id="inp-show-date" checked>
                    </div>
                </div>
            </div>

            <!-- TAB 4: MEDIA & LAINNYA -->
            <div id="tab-media" class="tab-content">
                <div class="control-group">
                    <h4>Logo Instansi</h4>
                    <div class="switch-wrap">
                        <span>Tampilkan Logo</span>
                        <input type="checkbox" id="inp-show-logo">
                    </div>
                    <label>URL Logo (Link Gambar)</label>
                    <input type="text" id="inp-logo-url" placeholder="https://link-logo-anda.png">
                    <p style="font-size:0.8rem; color:#888; margin-top:5px;">Gunakan link gambar PNG transparan agar bagus.</p>
                </div>

                <div class="control-group">
                    <h4>Darurat</h4>
                    <button class="btn-action btn-danger" onclick="blackoutMode()">‚ö´ MODE BLACKOUT (MATI)</button>
                    <p style="font-size:0.8rem; color:#aaa; text-align:center; margin-top:5px;">Membuat layar jadi hitam total.</p>
                </div>
            </div>

            <!-- TOMBOL SIMPAN MELAYANG -->
            <div style="padding: 20px; position: sticky; bottom: 0; background: #121212; border-top: 1px solid #333;">
                <button class="btn-action btn-save" id="btn-sync">üì° UPDATE KE PROYEKTOR</button>
            </div>
        </div>
    </div>

    <script type="module">
        // ----------------------------------------------------
        // UTILS
        // ----------------------------------------------------
        function log(msg) {
            const box = document.getElementById('debug-log');
            box.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
            console.log(msg);
        }
        
        // Expose functions to window
        window.switchTab = (tabId) => {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            // Highlight button (hacky but works)
            const btns = document.querySelectorAll('.tab-btn');
            if(tabId==='tab-visual') btns[0].classList.add('active');
            if(tabId==='tab-clock') btns[1].classList.add('active');
            if(tabId==='tab-text') btns[2].classList.add('active');
            if(tabId==='tab-media') btns[3].classList.add('active');
        };

        window.toggleBgInput = () => {
            const mode = document.getElementById('inp-bg-mode').value;
            document.getElementById('bg-color-group').style.display = mode === 'color' ? 'block' : 'none';
            document.getElementById('bg-url-group').style.display = mode === 'image' ? 'block' : 'none';
        };

        window.blackoutMode = () => {
            if(confirm("Layar akan menjadi hitam total?")) {
                document.getElementById('inp-bg-mode').value = 'color';
                document.getElementById('inp-bg-color').value = '#000000';
                document.getElementById('inp-text-color').value = '#000000'; // Hide text
                document.getElementById('inp-show-marquee').checked = false;
                // Trigger save auto
                document.getElementById('btn-sync').click();
            }
        };

        window.closeAdmin = () => document.getElementById('admin-panel').style.display = 'none';

        // ----------------------------------------------------
        // FIREBASE LOGIC
        // ----------------------------------------------------
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // FIREBASE CONFIG MILIK ANDA
        const firebaseConfig = {
            apiKey: "AIzaSyDoPT7JSD5N-p2V50PnozpAGvln64eREFI",
            authDomain: "jamdigi-7f8a3.firebaseapp.com",
            projectId: "jamdigi-7f8a3",
            storageBucket: "jamdigi-7f8a3.firebasestorage.app",
            messagingSenderId: "725447503980",
            appId: "1:725447503980:web:2a7c472a35dc71dae3a849",
            measurementId: "G-PESLX8VZ5W"
        };

        let db;
        const DOC_ID = "mega_settings"; // Nama dokumen baru untuk versi mega

        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            log("‚úÖ Firebase Ready");
        } catch (e) {
            log("‚ùå Error Init: " + e.message);
        }

        // --- LISTENER (RECEIVER) ---
        if (db) {
            const docRef = doc(db, "settings", DOC_ID);
            onSnapshot(docRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    applyConfig(data);
                    syncInputs(data);
                    log("üì• Data Updated!");
                } else {
                    log("‚ö†Ô∏è Setup Default Data...");
                }
            }, (err) => {
                log("‚ùå Sync Error: " + err.code);
            });
        }

        // --- SENDER (ADMIN) ---
        document.getElementById('btn-sync').addEventListener('click', async () => {
            const btn = document.getElementById('btn-sync');
            btn.innerText = "Mengirim...";
            
            // Collect ALL Data
            const bgMode = document.getElementById('inp-bg-mode').value;
            let finalBg = '#000000';
            if(bgMode === 'color') finalBg = document.getElementById('inp-bg-color').value;
            if(bgMode === 'gradient') finalBg = 'linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d)';
            if(bgMode === 'image') finalBg = `url('${document.getElementById('inp-bg-url').value}')`;

            const newData = {
                bgType: finalBg, // CSS Value
                
                // Visual Presets
                bgModeState: bgMode, // For input sync
                bgColorState: document.getElementById('inp-bg-color').value,
                bgUrlState: document.getElementById('inp-bg-url').value,
                
                textColor: document.getElementById('inp-text-color').value,
                fontFamily: document.getElementById('inp-font').value,
                
                // Clock
                clockSize: document.getElementById('inp-clock-size').value,
                clockGlow: document.getElementById('inp-clock-glow').value,
                clockShadow: document.getElementById('inp-clock-shadow').value,
                
                // Title
                showTitle: document.getElementById('inp-show-title').checked,
                titleText: document.getElementById('inp-title-text').value,
                titleColor: document.getElementById('inp-title-color').value,

                // Marquee
                showMarquee: document.getElementById('inp-show-marquee').checked,
                marqueeText: document.getElementById('inp-marquee-text').value,
                marqueeColor: document.getElementById('inp-marquee-color').value,
                marqueeBg: document.getElementById('inp-marquee-bg').value,
                marqueeSpeed: document.getElementById('inp-marquee-speed').value,

                // Media
                showDate: document.getElementById('inp-show-date').checked,
                showLogo: document.getElementById('inp-show-logo').checked,
                logoUrl: document.getElementById('inp-logo-url').value
            };

            try {
                await setDoc(doc(db, "settings", DOC_ID), newData);
                btn.innerText = "‚úÖ SUKSES";
                setTimeout(()=>btn.innerText="üì° UPDATE KE PROYEKTOR", 1500);
            } catch (e) {
                alert("Gagal: " + e.message);
                btn.innerText = "GAGAL";
            }
        });

        // ----------------------------------------------------
        // LOGIC VISUAL
        // ----------------------------------------------------
        function applyConfig(data) {
            const root = document.documentElement.style;
            
            // BG & Font
            root.setProperty('--bg-type', data.bgType);
            root.setProperty('--text-color', data.textColor);
            root.setProperty('--font-family', data.fontFamily);
            
            // Clock
            root.setProperty('--clock-size', data.clockSize + 'vw');
            root.setProperty('--clock-glow', data.clockGlow + 'px');
            root.setProperty('--clock-shadow', data.clockShadow);
            
            // Title
            root.setProperty('--title-display', data.showTitle ? 'block' : 'none');
            document.getElementById('main-title').innerText = data.titleText || "INSTANSI";
            root.setProperty('--title-color', data.titleColor);
            
            // Marquee
            root.setProperty('--marquee-display', data.showMarquee ? 'block' : 'none');
            document.getElementById('marquee-text').innerText = data.marqueeText || "...";
            root.setProperty('--marquee-color', data.marqueeColor);
            root.setProperty('--marquee-bg', data.marqueeBg);
            root.setProperty('--marquee-speed', data.marqueeSpeed + 's');
            
            // Others
            root.setProperty('--date-display', data.showDate ? 'block' : 'none');
            
            const logo = document.getElementById('logo-img');
            if(data.showLogo && data.logoUrl) {
                logo.src = data.logoUrl;
                logo.style.display = 'block';
            } else {
                logo.style.display = 'none';
            }
        }

        // Sync inputs in Admin Panel so user sees current state
        function syncInputs(data) {
            if(data.bgModeState) document.getElementById('inp-bg-mode').value = data.bgModeState;
            if(data.bgColorState) document.getElementById('inp-bg-color').value = data.bgColorState;
            if(data.bgUrlState) document.getElementById('inp-bg-url').value = data.bgUrlState;
            toggleBgInput(); // Refresh UI visibility

            document.getElementById('inp-text-color').value = data.textColor;
            document.getElementById('inp-font').value = data.fontFamily;
            
            document.getElementById('inp-clock-size').value = data.clockSize;
            document.getElementById('inp-clock-glow').value = data.clockGlow;
            document.getElementById('inp-clock-shadow').value = data.clockShadow;
            
            document.getElementById('inp-show-title').checked = data.showTitle;
            document.getElementById('inp-title-text').value = data.titleText;
            document.getElementById('inp-title-color').value = data.titleColor;

            document.getElementById('inp-show-marquee').checked = data.showMarquee;
            document.getElementById('inp-marquee-text').value = data.marqueeText;
            document.getElementById('inp-marquee-color').value = data.marqueeColor;
            document.getElementById('inp-marquee-bg').value = data.marqueeBg;
            document.getElementById('inp-marquee-speed').value = data.marqueeSpeed;

            document.getElementById('inp-show-date').checked = data.showDate;
            document.getElementById('inp-show-logo').checked = data.showLogo;
            document.getElementById('inp-logo-url').value = data.logoUrl;
        }

        // CLOCK ENGINE
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('id-ID', { hour12: false });
            
            // Update date every minute only
            if(now.getSeconds() === 0) {
                const opt = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('date').innerText = now.toLocaleDateString('id-ID', opt);
            }
        }
        setInterval(updateClock, 1000);
        
        // Init Date
        const opt = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('date').innerText = new Date().toLocaleDateString('id-ID', opt);

        // OPEN ADMIN
        document.getElementById('admin-trigger').addEventListener('click', () => {
            const p = prompt("PIN Admin");
            if(p === "1234") document.getElementById('admin-panel').style.display = 'block';
        });

    </script>
</body>
</html>


